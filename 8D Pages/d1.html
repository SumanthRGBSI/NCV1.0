<section class="container">
  <link rel="stylesheet" href="../assets/8d.css">
  <div class="card header toolbar">
    <div>
      <div class="h-title">D1 â€” Identify Team ðŸ‘¥</div>
      <div class="h-sub">Assemble the right team. Search, add, and tag roles quickly.</div>
    </div>
    <div class="controls">
      <div class="timestamp">Last updated: <span id="d1-timestamp">Never</span></div>
      <select id="d1-status-select" class="input select-compact status-select" data-id="d1">
        <option value="pending">Pending</option>
        <option value="in-progress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
    </div>
  </div>

  <datalist id="contact-directory"></datalist>

  <div class="card">
    <div class="section-title sticky-section-title">Team</div>
    <div class="row mt-small">
      <div class="col">
        <input id="d1-person-search" class="input" list="contact-directory" placeholder="Search directory and press Addâ€¦" />
      </div>
      <div class="col col-fixed">
        <button id="d1-add-person" class="btn btn-primary">Add</button>
        <button id="d1-add-me" class="btn btn-ghost">Add Me</button>
      </div>
    </div>

    <table id="d1-team-unified" class="table table-alt">
      <thead>
        <tr>
          <th>Name</th>
          <th>Roles</th>
          <th>Title</th>
          <th>Contact</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="5"><button type="button" class="add-row-btn btn btn-ghost"><i data-lucide="plus"></i> Add Member</button></td>
        </tr>
      </tfoot>
    </table>
    <template id="d1-row-template">
      <tr>
        <td>
          <input class="input contact-name" list="contact-directory" placeholder="Full name" />
        </td>
        <td>
          <div class="role-radio-group small">
            <div class="radio-row">
              <label class="radio-option"><input type="radio" class="member-role" name="member-role-__" value="KPOC"/> KPOC</label>
              <label class="radio-option"><input type="radio" class="member-role" name="member-role-__" value="Champion"/> Champion</label>
              <label class="radio-option"><input type="radio" class="member-role" name="member-role-__" value="Team Member"/> Team Member</label>
            </div>
          </div>
        </td>
        <td>
          <input class="input contact-title" placeholder="Job title" />
        </td>
        <td>
          <div class="controls">
            <button type="button" class="btn btn-ghost contact-pop" title="View contact"><i data-lucide="contact"></i> Details</button>
            <input class="input contact-email" placeholder="name@company.com" style="display:none" />
            <input class="input contact-phone" placeholder="(555) 555-5555" style="display:none" />
          </div>
        </td>
        <td>
          <button type="button" class="remove-row-btn btn btn-danger" aria-label="Remove"><i data-lucide="trash-2"></i></button>
        </td>
      </tr>
    </template>
  </div>

  <div class="card">
    <div class="section-title sticky-section-title">Visuals</div>
    <div class="row mt-small">
      <div class="col">
        <div class="section-title">Team Cards</div>
        <div id="d1-team-cards" class="team-cards-grid mt-small"></div>
      </div>
      <div class="col">
        <div class="section-title">Team Org Chart</div>
        <div id="d1-org-chart" class="mt-small"></div>
      </div>
    </div>
  </div>

  <script src="../assets/8d-forms.js"></script>
  <script>
    window.__init8D && window.__init8D(document);
    (function(){
      function qs(s, c=document){return c.querySelector(s)}
      function qsa(s, c=document){return Array.from((c||document).querySelectorAll(s))}
      function addRow(){
        const tpl = qs('#d1-row-template'); const tbody = qs('#d1-team-unified tbody'); if(!tpl||!tbody) return;
        const node = tpl.content.firstElementChild.cloneNode(true);
        const idx = (tbody.children.length||0) + 1;
        node.querySelectorAll('input.member-role').forEach(r=>{ r.name = 'member-role-'+Date.now()+'-'+idx; });
        tbody.appendChild(node);
      }
      document.addEventListener('click', (e)=>{
        if(e.target.closest('.add-row-btn')){ addRow(); }
        if(e.target.closest('#d1-add-person')){ addRow(); const v = qs('#d1-person-search').value.trim(); if(v){ const last = qs('#d1-team-unified tbody tr:last-child'); last.querySelector('.contact-name').value = v; last.querySelector('.contact-email').value = (v.split(' ')[0]||'').toLowerCase()+'.'+(v.split(' ')[1]||'').toLowerCase()+'@example.com'; }
          qs('#d1-person-search').value=''; window.__init8D && window.__init8D(document); }
        if(e.target.closest('.contact-pop')){ const tr = e.target.closest('tr'); const name = tr.querySelector('.contact-name')?.value||''; const emailInp= tr.querySelector('.contact-email'); const phoneInp= tr.querySelector('.contact-phone'); const email= emailInp?.value||''; const phone= phoneInp?.value||''; const modal=document.createElement('div'); modal.className='modal-overlay'; const card=document.createElement('div'); card.className='card modal-card'; card.innerHTML = `<div class="flex-between"><div class="h-title">${name||'Contact'}</div><button class="icon-btn" id="pop-close">âœ•</button></div><div class="mt-small"><label class="label">Email</label><input id="pop-email" class="input" value="${email}"/><label class="label mt-small">Phone</label><input id="pop-phone" class="input" value="${phone}"/><div class="controls mt-small"><button class="btn btn-primary" id="pop-save">Save</button></div></div>`; modal.appendChild(card); document.body.appendChild(modal); modal.addEventListener('click', (ev)=>{ if(ev.target.id==='pop-close'||ev.target===modal) modal.remove(); }); card.querySelector('#pop-save')?.addEventListener('click', ()=>{ if(emailInp) emailInp.value = card.querySelector('#pop-email').value; if(phoneInp) phoneInp.value = card.querySelector('#pop-phone').value; modal.remove(); window.__init8D && window.__init8D(document); }); }
      });
      // Seed one row
      if(!qs('#d1-team-unified tbody tr')) addRow();
      // Ensure unique radio groups for existing rows (e.g., after reload)
      Array.from(qs('#d1-team-unified tbody')?.children||[]).forEach((tr,i)=>{
        tr.querySelectorAll('input.member-role').forEach(r=>{ r.name = r.name && r.name!=='member-role-__' ? r.name : ('member-role-'+Date.now()+'-'+(i+1)); });
      });
    })();
  </script>
</section>
